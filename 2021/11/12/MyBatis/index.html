

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/yiang-logo.png">
  <link rel="icon" href="/img/yiang-logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Alvis">
  <meta name="keywords" content="">
  <meta name="description" content="[toc] 一.下载MyBatisgithub下载地址 二.MyBatis操作数据库 创建MyBatis全局配置文件  &#x2F;conf&#x2F;mybatis-config.xml 123456789101112131415161718192021&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE conf">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis">
<meta property="og:url" content="http://example.com/2021/11/12/MyBatis/index.html">
<meta property="og:site_name" content="Alvis-blog">
<meta property="og:description" content="[toc] 一.下载MyBatisgithub下载地址 二.MyBatis操作数据库 创建MyBatis全局配置文件  &#x2F;conf&#x2F;mybatis-config.xml 123456789101112131415161718192021&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE conf">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-11-12T11:28:33.000Z">
<meta property="article:modified_time" content="2021-11-23T14:23:14.329Z">
<meta property="article:author" content="Alvis">
<meta property="article:tag" content="MyBatis">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary_large_image">
  
  <title>MyBatis - Alvis-blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Alvis&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="MyBatis">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-11-12 19:28" pubdate>
        November 12, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      49k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      152 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MyBatis</h1>
            
            <div class="markdown-body">
              <p>[toc]</p>
<h1 id="一-下载MyBatis"><a href="#一-下载MyBatis" class="headerlink" title="一.下载MyBatis"></a>一.下载MyBatis</h1><p><a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/">github下载地址</a></p>
<h1 id="二-MyBatis操作数据库"><a href="#二-MyBatis操作数据库" class="headerlink" title="二.MyBatis操作数据库"></a>二.MyBatis操作数据库</h1><ol>
<li>创建MyBatis全局配置文件</li>
</ol>
<p>/conf/mybatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">configuration</span></span><br><span class="hljs-meta"> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span> /&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span><br>				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span> /&gt;</span><br>				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span> /&gt;</span><br>				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123456&quot;</span> /&gt;</span><br>			<span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>		<span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br>	<span class="hljs-comment">&lt;!-- 将我们写好的sql映射文件（EmployeeMapper.xml）一定要注册到全局配置文件（mybatis-config.xml）中 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;EmployeeMapper.xml&quot;</span> /&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>



<ol start="2">
<li>创建sql映射文件</li>
</ol>
<p>/conf/EmployeeMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><br><span class="hljs-meta"> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.dao.EmployeeMapper&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">namespace:名称空间;指定为接口的全类名</span><br><span class="hljs-comment">id：唯一标识</span><br><span class="hljs-comment">resultType：返回值类型</span><br><span class="hljs-comment">#&#123;id&#125;：从传递过来的参数中取出id值</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">public Employee getEmpById(Integer id);</span><br><span class="hljs-comment"> --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span><br>		select id,last_name lastName,email,gender from tbl_employee where id = #&#123;id&#125;<br>	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>



<ol start="3">
<li>测试</li>
</ol>
<ul>
<li>根据全局配置文件，利用SqlSessionFactoryBuilder创建SqlSessionFactory</li>
<li>使用SqlSessionFactory获取sqlSession对象。一个SqlSession对象代表和数据库的一次会话。</li>
<li>使用SqlSession根据方法id进行操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.mybatis.test;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><br><span class="hljs-keyword">import</span> org.apache.ibatis.io.Resources;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><br><span class="hljs-keyword">import</span> com.atguigu.mybatis.bean.Employee;<br><span class="hljs-keyword">import</span> com.atguigu.mybatis.dao.EmployeeMapper;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1、接口式编程</span><br><span class="hljs-comment"> * 	原生：		Dao		====&gt;  DaoImpl</span><br><span class="hljs-comment"> * 	mybatis：	Mapper	====&gt;  xxMapper.xml</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * 2、SqlSession代表和数据库的一次会话；用完必须关闭；</span><br><span class="hljs-comment"> * 3、SqlSession和connection一样她都是非线程安全。每次使用都应该去获取新的对象。</span><br><span class="hljs-comment"> * 4、mapper接口没有实现类，但是mybatis会为这个接口生成一个代理对象。</span><br><span class="hljs-comment"> * 		（将接口和xml进行绑定）</span><br><span class="hljs-comment"> * 		EmployeeMapper empMapper =	sqlSession.getMapper(EmployeeMapper.class);</span><br><span class="hljs-comment"> * 5、两个重要的配置文件：</span><br><span class="hljs-comment"> * 		mybatis的全局配置文件：包含数据库连接池信息，事务管理器信息等...系统运行环境信息</span><br><span class="hljs-comment"> * 		sql映射文件：保存了每一个sql语句的映射信息：</span><br><span class="hljs-comment"> * 					将sql抽取出来。	</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> lfy</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisTest</span> </span>&#123;<br>	<br><br>    <span class="hljs-comment">//根据全局配置文件，利用SqlSessionFactoryBuilder创建SqlSessionFactory</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> SqlSessionFactory <span class="hljs-title">getSqlSessionFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>		String resource = <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>;<br>		InputStream inputStream = Resources.getResourceAsStream(resource);<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * 1、根据xml配置文件（全局配置文件）创建一个SqlSessionFactory对象 有数据源一些运行环境信息</span><br><span class="hljs-comment">	 * 2、sql映射文件；配置了每一个sql，以及sql的封装规则等。 </span><br><span class="hljs-comment">	 * 3、将sql映射文件注册在全局配置文件中</span><br><span class="hljs-comment">	 * 4、写代码：</span><br><span class="hljs-comment">	 * 		1）、根据全局配置文件得到SqlSessionFactory；</span><br><span class="hljs-comment">	 * 		2）、使用sqlSession工厂，获取到sqlSession对象使用他来执行增删改查</span><br><span class="hljs-comment">	 * 			一个sqlSession就是代表和数据库的一次会话，用完关闭</span><br><span class="hljs-comment">	 * 		3）、使用sql的唯一标志来告诉MyBatis执行哪个sql。sql都是保存在sql映射文件中的。</span><br><span class="hljs-comment">	 * </span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Test</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br><br>		<span class="hljs-comment">// 2、获取sqlSession实例，能直接执行已经映射的sql语句</span><br>		<span class="hljs-comment">// sql的唯一标识：statement Unique identifier matching the statement to use.</span><br>		<span class="hljs-comment">// 执行sql要用的参数：parameter A parameter object to pass to the statement.</span><br>		SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();<br><br>		SqlSession openSession = sqlSessionFactory.openSession();<br>		<span class="hljs-keyword">try</span> &#123;<br>			Employee employee = openSession.selectOne(<br>					<span class="hljs-string">&quot;com.atguigu.mybatis.EmployeeMapper.selectEmp&quot;</span>, <span class="hljs-number">1</span>);<br>			System.out.println(employee);<br>		&#125; <span class="hljs-keyword">finally</span> &#123;<br>			openSession.close();<br>		&#125;<br><br>	&#125;<br><br>	<span class="hljs-meta">@Test</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test01</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>		<span class="hljs-comment">// 1、获取sqlSessionFactory对象</span><br>		SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();<br>		<span class="hljs-comment">// 2、获取sqlSession对象</span><br>		SqlSession openSession = sqlSessionFactory.openSession();<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-comment">// 3、获取接口的实现类对象</span><br>			<span class="hljs-comment">//会为接口自动的创建一个代理对象，代理对象去执行增删改查方法</span><br>			EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);<br>			Employee employee = mapper.getEmpById(<span class="hljs-number">1</span>);<br>			System.out.println(mapper.getClass());<br>			System.out.println(employee);<br>		&#125; <span class="hljs-keyword">finally</span> &#123;<br>			openSession.close();<br>		&#125;<br><br>	&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>注意点</li>
</ol>
<ul>
<li>SqlSession 的实例<strong>不是线程安全</strong>的，因此是不能被共享的。 </li>
<li>SqlSession每次<strong>使用完成后需要正确关闭</strong>，这个关闭操作是必须的</li>
<li>SqlSession可以直接调用方法的id进行数据库操作，但是我们一般还是推荐使用SqlSession获取到Dao接口的代理类，执行代理对象的方法，可以更安全的进行类型检查操作</li>
</ul>
<h1 id="三-MyBatis全局配置文件"><a href="#三-MyBatis全局配置文件" class="headerlink" title="三.MyBatis全局配置文件"></a>三.MyBatis全局配置文件</h1><p>MyBatis 的配置文件包含了影响 MyBatis 行为甚深的设置（settings）和属性（properties）信息。文档的顶层结构如下： </p>
<p>configuration 配置</p>
<blockquote>
<p>properties 属性</p>
</blockquote>
<blockquote>
<p>settings 设置</p>
</blockquote>
<blockquote>
<p>typeAliases 类型命名</p>
</blockquote>
<blockquote>
<p>typeHandlers 类型处理器</p>
</blockquote>
<blockquote>
<p>objectFactory 对象工厂</p>
</blockquote>
<blockquote>
<p>plugins 插件</p>
</blockquote>
<blockquote>
<p>environments 环境</p>
</blockquote>
<blockquote>
<blockquote>
<p>environment 环境变量</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>transactionManager 事务管理器</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>dataSource 数据源</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<p>databaseIdProvider 数据库厂商标识</p>
</blockquote>
<blockquote>
<p>mappers 映射器</p>
</blockquote>
<h1 id="四-MyBatis映射文件"><a href="#四-MyBatis映射文件" class="headerlink" title="四.MyBatis映射文件"></a>四.MyBatis映射文件</h1><h2 id="参数处理"><a href="#参数处理" class="headerlink" title="参数处理"></a>参数处理</h2><h3 id="与-取值区别"><a href="#与-取值区别" class="headerlink" title="#{}与${}取值区别"></a>#{}与${}取值区别</h3><p>#{}：预编译形式，将==参数==设置到sql语句中，PreparedStatement；防止sql注入</p>
<p>${}：取出的值直接拼装在sql语句中，会有安全问题；</p>
<p>大多情况使用#{};</p>
<p>原生jdbc不支持占位符的地方我们就可以使用${}进行取值</p>
<p>比如分表、排序；按照年份分表拆分：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> $&#123;<span class="hljs-keyword">year</span>&#125;_salary <span class="hljs-keyword">where</span> xxx;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbl_employee <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> $&#123;f_name&#125; $&#123;<span class="hljs-keyword">order</span>&#125;;<br></code></pre></td></tr></table></figure>



<h3 id="：更丰富的用法："><a href="#：更丰富的用法：" class="headerlink" title="#{}：更丰富的用法："></a>#{}：更丰富的用法：</h3><p>规定参数的一些规则：</p>
<p>javaType、jdbcType、mode（存储过程）、numericScale、resultMap、typeHandler、jdbcTypeName、expression（未来准备支持的功能）；</p>
<ul>
<li>jdbcType通常需要在某种特定的条件下被设置：</li>
</ul>
<p>在我们数据为null的时候，有些数据库可能不能识别mybatis对null的默认处理。比如Oracle（报错）。jdbcType OTHER：无效的类型；因为mybatis对所有的null都映射的是原生Jdbc的OTHER类型，oracle不能正确处理。</p>
<p>根本原因：mybatis全局配置中：jdbcTypeForNull=OTHER：oracle不支持。两种解决方式：</p>
<ol>
<li>在sql语句中设置：#{字段名,jdbcType=null}；</li>
<li>修改mybatis全局配置文件：jdbcTypeForNull=NULL</li>
</ol>
<h2 id="返回类型-resultType"><a href="#返回类型-resultType" class="headerlink" title="返回类型(resultType)"></a>返回类型(resultType)</h2><h3 id="返回对象的list"><a href="#返回对象的list" class="headerlink" title="返回对象的list"></a>返回对象的list</h3><p>resultType值设为对象的全类名</p>
<h3 id="返回map"><a href="#返回map" class="headerlink" title="返回map"></a>返回map</h3><h4 id="一条记录的map"><a href="#一条记录的map" class="headerlink" title="一条记录的map"></a>一条记录的map</h4><p>key就是列名，值就是对应的值</p>
<p>resultType值设为map</p>
<h4 id="多条记录的map"><a href="#多条记录的map" class="headerlink" title="多条记录的map"></a>多条记录的map</h4><p>Map&lt;Integer,Employee&gt;：键是这条记录的主键，值是记录封装后的javabean</p>
<p>resultType值设为对象的全类名（xxx.xxx.Employee）</p>
<p>在mapper文件中，加注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//告诉mybatis封装这个map的时候使用哪个属性作为主键</span><br><span class="hljs-meta">@MapKey(&quot;id&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;Integer,Employee&gt; <span class="hljs-title">getEmpByLastNameLikeReturnMap</span><span class="hljs-params">(String lastname)</span></span>;<br></code></pre></td></tr></table></figure>



<h2 id="返回类型（resultMap）"><a href="#返回类型（resultMap）" class="headerlink" title="返回类型（resultMap）"></a>返回类型（resultMap）</h2><h3 id="association-定义对象-一个员工对应一个部门"><a href="#association-定义对象-一个员工对应一个部门" class="headerlink" title="association(定义对象,一个员工对应一个部门)"></a>association(定义对象,一个员工对应一个部门)</h3><p>复杂对象映射，pojo中的属性可能是一个对象，使用联合查询</p>
<ul>
<li>以级联属性的方式封装对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;resultMap type=<span class="hljs-string">&quot;com.xxx.xxx.Employee&quot;</span> id=<span class="hljs-string">&quot;MyDifEmp&quot;</span>&gt;<br>    &lt;id column=<span class="hljs-string">&quot;id&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;    <br>	&lt;result column=<span class="hljs-string">&quot;last_name&quot;</span> property=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;<br>    &lt;result column=<span class="hljs-string">&quot;gender&quot;</span> property=<span class="hljs-string">&quot;gender&quot;</span>/&gt;<br>    &lt;result column=<span class="hljs-string">&quot;did&quot;</span> property=<span class="hljs-string">&quot;dept.id&quot;</span>/&gt;<br>    &lt;result column=<span class="hljs-string">&quot;dept_name&quot;</span> property=<span class="hljs-string">&quot;dept.departmentName&quot;</span>/&gt;<br>&lt;/resultMap&gt;<br><br>&lt;select id=<span class="hljs-string">&quot;getEmpAndDept&quot;</span> resultMap=<span class="hljs-string">&quot;MyDifEmp&quot;</span>&gt;<br>    SELECT e.id id,e.last_name last_name,e.gender gender,e.d_id d_id,d.dept_name dept_name from tbl_employee e,tbl_dept d where e.d_id=d.id AND e.id=#&#123;id&#125;<br>&lt;/select&gt;<br></code></pre></td></tr></table></figure>



<ul>
<li>association-嵌套结果集</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;resultMap type=<span class="hljs-string">&quot;com.xxx.xxx.Employee&quot;</span> id=<span class="hljs-string">&quot;MyDifEmp&quot;</span>&gt;<br>    &lt;id column=<span class="hljs-string">&quot;id&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;    <br>	&lt;result column=<span class="hljs-string">&quot;last_name&quot;</span> property=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;<br>    &lt;result column=<span class="hljs-string">&quot;gender&quot;</span> property=<span class="hljs-string">&quot;gender&quot;</span>/&gt;<br>    &lt;association property=<span class="hljs-string">&quot;dept&quot;</span> javaType=<span class="hljs-string">&quot;com.xxx.xxx.Dept&quot;</span>&gt;<br>		&lt;id column=<span class="hljs-string">&quot;did&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;<br>    	&lt;result column=<span class="hljs-string">&quot;dept_name&quot;</span> property=<span class="hljs-string">&quot;departmentName&quot;</span>/&gt;<br>    &lt;/association&gt;<br>&lt;/resultMap&gt;<br></code></pre></td></tr></table></figure>



<ul>
<li>association-分段查询</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;resultMap type=<span class="hljs-string">&quot;com.xxx.xxx.Employee&quot;</span> id=<span class="hljs-string">&quot;MyDifEmp&quot;</span>&gt;<br>    &lt;id column=<span class="hljs-string">&quot;id&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;    <br>	&lt;result column=<span class="hljs-string">&quot;last_name&quot;</span> property=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;<br>    &lt;result column=<span class="hljs-string">&quot;gender&quot;</span> property=<span class="hljs-string">&quot;gender&quot;</span>/&gt;<br>    &lt;association property=<span class="hljs-string">&quot;dept&quot;</span> <br>    	select=<span class="hljs-string">&quot;com.xxx.xxx.EmployeeMapper.getEmpAndDeptById&quot;</span><br>	    colunm=<span class="hljs-string">&quot;did&quot;</span>&gt;<br>    &lt;/association&gt;<br>&lt;/resultMap&gt;<br></code></pre></td></tr></table></figure>

<p>select：调用目标的方法查询当前属性的值</p>
<p>column：将指定列的值传入目标方法</p>
<ul>
<li>association-分段查询&amp;延迟加载</li>
</ul>
<p>开启延迟加载和属性按需加载</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lazyLoadingEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;aggressiveLazyLoading&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h3 id="collection（定义集合，一个部门对应多个员工）"><a href="#collection（定义集合，一个部门对应多个员工）" class="headerlink" title="collection（定义集合，一个部门对应多个员工）"></a>collection（定义集合，一个部门对应多个员工）</h3><ul>
<li>Collection-集合类型&amp;嵌套结果集</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;resultMap type=<span class="hljs-string">&quot;com.xxx.xxx.Department&quot;</span> id=<span class="hljs-string">&quot;MyDept&quot;</span>&gt;<br>    &lt;id column=<span class="hljs-string">&quot;did&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;    <br>	&lt;result column=<span class="hljs-string">&quot;dept_name&quot;</span> property=<span class="hljs-string">&quot;departmentName&quot;</span>/&gt;<br>    &lt;result column=<span class="hljs-string">&quot;gender&quot;</span> property=<span class="hljs-string">&quot;gender&quot;</span>/&gt;<br>    &lt;collection property=<span class="hljs-string">&quot;emps&quot;</span> ofType=<span class="hljs-string">&quot;com.xxx.xxx.Employee&quot;</span> <br>    	&lt;id column=<span class="hljs-string">&quot;eid&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;<br>    	&lt;result column=<span class="hljs-string">&quot;last_name&quot;</span> property=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;<br>    	&lt;result column=<span class="hljs-string">&quot;email&quot;</span> property=<span class="hljs-string">&quot;email&quot;</span>/&gt;<br>    	&lt;result column=<span class="hljs-string">&quot;gender&quot;</span> property=<span class="hljs-string">&quot;gender&quot;</span>/&gt;<br>    &lt;/collection&gt;<br>&lt;/resultMap&gt;<br><br>&lt;select id=<span class="hljs-string">&quot;getDeptByIdPlus&quot;</span> resultMap=<span class="hljs-string">&quot;MyDept&quot;</span>&gt;<br>    SELECT d.id did,d.dept_name dept_name,e.id eid,e.last_name last_name,e.email email,e.gender gender <br>    FROM tbl_dept d<br>    LEFT JOIN tbl_employee e<br>    ON d.id=e.d_id<br>    WHERE d.id=#&#123;id&#125;<br>    <br>&lt;/select&gt;<br></code></pre></td></tr></table></figure>



<ul>
<li>Collection-分步查询&amp;延迟加载</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;resultMap type=<span class="hljs-string">&quot;com.xxx.xxx.Department&quot;</span> id=<span class="hljs-string">&quot;MyDeptStep&quot;</span>&gt;<br>    &lt;id column=<span class="hljs-string">&quot;id&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;    <br>	&lt;result column=<span class="hljs-string">&quot;dept_name&quot;</span> property=<span class="hljs-string">&quot;departmentName&quot;</span>/&gt;<br>    &lt;collection property=<span class="hljs-string">&quot;emps&quot;</span> <br>    	select=<span class="hljs-string">&quot;com.xxx.xxx.EmployeeMapperPlus.getEmpsById&quot;</span><br>	    column=<span class="hljs-string">&quot;id&quot;</span><br>    &gt;<br>    	&lt;id column=<span class="hljs-string">&quot;eid&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;<br>    	&lt;result column=<span class="hljs-string">&quot;last_name&quot;</span> property=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;<br>    	&lt;result column=<span class="hljs-string">&quot;email&quot;</span> property=<span class="hljs-string">&quot;email&quot;</span>/&gt;<br>    	&lt;result column=<span class="hljs-string">&quot;gender&quot;</span> property=<span class="hljs-string">&quot;gender&quot;</span>/&gt;<br>    &lt;/collection&gt;<br>&lt;/resultMap&gt;<br><br>&lt;select id=<span class="hljs-string">&quot;getDeptByIdStep&quot;</span> resultMap=<span class="hljs-string">&quot;MyDeptStep&quot;</span>&gt;<br>    SELECT id,dept_name<br>    FROM tbl_dept<br>    WHERE id=#&#123;id&#125;<br>&lt;/select&gt;<br></code></pre></td></tr></table></figure>



<h3 id="扩展-分布查询，多列值封装map传递"><a href="#扩展-分布查询，多列值封装map传递" class="headerlink" title="扩展-分布查询，多列值封装map传递"></a>扩展-分布查询，多列值封装map传递</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;resultMap type=<span class="hljs-string">&quot;com.xxx.xxx.Department&quot;</span> id=<span class="hljs-string">&quot;MyDeptStep&quot;</span>&gt;<br>    &lt;id column=<span class="hljs-string">&quot;id&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;    <br>	&lt;result column=<span class="hljs-string">&quot;dept_name&quot;</span> property=<span class="hljs-string">&quot;departmentName&quot;</span>/&gt;<br>    &lt;collection property=<span class="hljs-string">&quot;emps&quot;</span> <br>    	select=<span class="hljs-string">&quot;com.xxx.xxx.EmployeeMapperPlus.getEmpsById&quot;</span><br>	    column=<span class="hljs-string">&quot;id&quot;</span><br>    &lt;!-- column=<span class="hljs-string">&quot;&#123;deptId=id&#125;&quot;</span>  fetchType=<span class="hljs-string">&quot;lazy&quot;</span> --&gt;<br>   &gt;<br>    <br>    <br>    	&lt;id column=<span class="hljs-string">&quot;eid&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;<br>    	&lt;result column=<span class="hljs-string">&quot;last_name&quot;</span> property=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;<br>    	&lt;result column=<span class="hljs-string">&quot;email&quot;</span> property=<span class="hljs-string">&quot;email&quot;</span>/&gt;<br>    	&lt;result column=<span class="hljs-string">&quot;gender&quot;</span> property=<span class="hljs-string">&quot;gender&quot;</span>/&gt;<br>    &lt;/collection&gt;<br>&lt;/resultMap&gt;<br><br>&lt;select id=<span class="hljs-string">&quot;getDeptByIdStep&quot;</span> resultMap=<span class="hljs-string">&quot;MyDeptStep&quot;</span>&gt;<br>    SELECT id,dept_name<br>    FROM tbl_dept<br>    WHERE id=#&#123;id&#125;<br>&lt;/select&gt;<br>    <br>    &lt;!--多列值封装map传递<br>    column=<span class="hljs-string">&quot;&#123;key1=column1,key2=column2&#125;&quot;</span><br>    fetchType=<span class="hljs-string">&quot;lazy&quot;</span>:表示使用延迟加载：<br>        lazy：延迟加载<br>        eager：立即加载<br>    --&gt;<br></code></pre></td></tr></table></figure>

<h2 id="discrominator鉴别器"><a href="#discrominator鉴别器" class="headerlink" title="discrominator鉴别器"></a>discrominator鉴别器</h2><p>判断某列的值，然后根据某列的值改变封装行为。</p>
<p>如果查出女生：部门信息查询出来，否则不查询；</p>
<p>如果查出男生：把last_name这一列的值赋值给email；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;resultMap type=<span class="hljs-string">&quot;com.xxx.xxx.Employee&quot;</span> id=<span class="hljs-string">&quot;MyDifEmp&quot;</span>&gt;<br>    &lt;id column=<span class="hljs-string">&quot;id&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;    <br>	&lt;result column=<span class="hljs-string">&quot;last_name&quot;</span> property=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;<br>    &lt;result column=<span class="hljs-string">&quot;email&quot;</span> property=<span class="hljs-string">&quot;email&quot;</span>/&gt;<br>    &lt;result column=<span class="hljs-string">&quot;gender&quot;</span> property=<span class="hljs-string">&quot;gender&quot;</span>/&gt;<br>    &lt;!--<br>    	column:指定判定的列名<br>        javaType：列值对应的java类型<br>    --&gt;<br>    &lt;discriminator javaType=<span class="hljs-string">&quot;string&quot;</span> column=<span class="hljs-string">&quot;gender&quot;</span>&gt;<br>    	&lt;!--女生 rsultType:指定封装的结果类型,不可缺少(或者resultMap)--&gt;<br>        &lt;<span class="hljs-keyword">case</span> value=<span class="hljs-string">&quot;0&quot;</span> rsultType=<span class="hljs-string">&quot;com.xxx.xxx.Employee&quot;</span>&gt;<br>            &lt;association property=<span class="hljs-string">&quot;dept&quot;</span> <br>    			select=<span class="hljs-string">&quot;com.xxx.xxx.EmployeeMapper.getEmpAndDeptById&quot;</span><br>	    		colunm=<span class="hljs-string">&quot;did&quot;</span>&gt;<br>    		&lt;/association&gt;<br>        &lt;/<span class="hljs-keyword">case</span>&gt;<br>            <br>        &lt;!---男生-&gt;<br>        &lt;<span class="hljs-keyword">case</span> value=<span class="hljs-string">&quot;1&quot;</span>&gt;<br>            &lt;id column=<span class="hljs-string">&quot;id&quot;</span> property=<span class="hljs-string">&quot;id&quot;</span>/&gt;    <br>			&lt;result column=<span class="hljs-string">&quot;last_name&quot;</span> property=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;<br>            &lt;result column=<span class="hljs-string">&quot;last_name&quot;</span> property=<span class="hljs-string">&quot;email&quot;</span>/&gt;<br>    		&lt;result column=<span class="hljs-string">&quot;gender&quot;</span> property=<span class="hljs-string">&quot;gender&quot;</span>/&gt;<br>        &lt;/<span class="hljs-keyword">case</span>&gt;<br>    &lt;/discriminator&gt;<br>    <br>    <br>&lt;/resultMap&gt;<br></code></pre></td></tr></table></figure>



<h1 id="五-MyBatis-动态SQL"><a href="#五-MyBatis-动态SQL" class="headerlink" title="五.MyBatis-动态SQL"></a>五.MyBatis-动态SQL</h1><ul>
<li><p>if：判断</p>
</li>
<li><p>choose(when,otherwise)</p>
</li>
<li><p>trim(where,set)</p>
<p>where：封装查询条件</p>
<p>set：封装修改条件</p>
</li>
<li><p>foreach</p>
</li>
</ul>
<h2 id="1-if"><a href="#1-if" class="headerlink" title="1.if"></a>1.if</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 查询员工，要求，携带了哪个字段查询条件就带上这个字段的值 --&gt;</span><br><span class="hljs-comment">&lt;!-- public List&lt;Employee&gt; getEmpsByConditionIf(Employee employee); --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpsByConditionIf&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span><br>    select * from tbl_employee<br>    <span class="hljs-comment">&lt;!-- where --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- test：判断表达式（OGNL）OGNL参照PPT或者官方文档。</span><br><span class="hljs-comment">        c:if  test</span><br><span class="hljs-comment">    从参数中取值进行判断</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    遇见特殊符号应该去写转义字符：</span><br><span class="hljs-comment">    &amp;&amp;：&amp;amp;&amp;amp;</span><br><span class="hljs-comment">    --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id!=null&quot;</span>&gt;</span><br>            id=#&#123;id&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;lastName!=null <span class="hljs-symbol">&amp;amp;</span><span class="hljs-symbol">&amp;amp;</span> lastName!=<span class="hljs-symbol">&amp;quot;</span><span class="hljs-symbol">&amp;quot;</span>&quot;</span>&gt;</span><br>            and last_name like #&#123;lastName&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;email!=null and email.trim()!=<span class="hljs-symbol">&amp;quot;</span><span class="hljs-symbol">&amp;quot;</span>&quot;</span>&gt;</span><br>            and email=#&#123;email&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span> <br>        <span class="hljs-comment">&lt;!-- ognl会进行字符串与数字的转换判断  &quot;0&quot;==0 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;gender==0 or gender==1&quot;</span>&gt;</span><br>            and gender=#&#123;gender&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>查询的时候如果某些条件没带可能sql拼装会有问题，两种解决方案：</p>
<ol>
<li>在where后面加上1=1，以后的条件都and xxx</li>
<li>使用<where></where>标签，将条件放在标签内。mybatis会将where标签中拼装的sql，多出来的and或者or去掉。但是如果and或者or放在条件的后面（条件1 and），此时就可能出现问题（当最后一个条件没有时，sql语句末尾多一个and或者or），这个问题可以采用<trim></trim>标签。</li>
</ol>
<h2 id="2-trim-where"><a href="#2-trim-where" class="headerlink" title="2.trim(where)"></a>2.trim(where)</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--public List&lt;Employee&gt; getEmpsByConditionTrim(Employee employee);  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpsByConditionTrim&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span><br>    select * from tbl_employee<br>    <span class="hljs-comment">&lt;!-- 后面多出的and或者or where标签不能解决 </span><br><span class="hljs-comment">   prefix=&quot;&quot;:前缀：trim标签体中是整个字符串拼串 后的结果。</span><br><span class="hljs-comment">     prefix给拼串后的整个字符串加一个前缀 </span><br><span class="hljs-comment">   prefixOverrides=&quot;&quot;:</span><br><span class="hljs-comment">     前缀覆盖： 去掉整个字符串前面多余的字符</span><br><span class="hljs-comment">   suffix=&quot;&quot;:后缀</span><br><span class="hljs-comment">     suffix给拼串后的整个字符串加一个后缀 </span><br><span class="hljs-comment">   suffixOverrides=&quot;&quot;</span><br><span class="hljs-comment">     后缀覆盖：去掉整个字符串后面多余的字符</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   --&gt;</span><br>    <span class="hljs-comment">&lt;!-- 自定义字符串的截取规则 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">&quot;where&quot;</span> <span class="hljs-attr">suffixOverrides</span>=<span class="hljs-string">&quot;and&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id!=null&quot;</span>&gt;</span><br>            id=#&#123;id&#125; and<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;lastName!=null <span class="hljs-symbol">&amp;amp;</span><span class="hljs-symbol">&amp;amp;</span> lastName!=<span class="hljs-symbol">&amp;quot;</span><span class="hljs-symbol">&amp;quot;</span>&quot;</span>&gt;</span><br>            last_name like #&#123;lastName&#125; and<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;email!=null and email.trim()!=<span class="hljs-symbol">&amp;quot;</span><span class="hljs-symbol">&amp;quot;</span>&quot;</span>&gt;</span><br>            email=#&#123;email&#125; and<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span> <br>        <span class="hljs-comment">&lt;!-- ognl会进行字符串与数字的转换判断  &quot;0&quot;==0 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;gender==0 or gender==1&quot;</span>&gt;</span><br>            gender=#&#123;gender&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">trim</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="3-choose"><a href="#3-choose" class="headerlink" title="3.choose"></a>3.choose</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- public List&lt;Employee&gt; getEmpsByConditionChoose(Employee employee); --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpsByConditionChoose&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span><br>    select * from tbl_employee <br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 如果带了id就用id查，如果带了lastName就用lastName查;只会进入其中一个when(或者otherwise) --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">choose</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id!=null&quot;</span>&gt;</span><br>                id=#&#123;id&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;lastName!=null&quot;</span>&gt;</span><br>                last_name like #&#123;lastName&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;email!=null&quot;</span>&gt;</span><br>                email = #&#123;email&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">otherwise</span>&gt;</span><br>                gender = 0<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">otherwise</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">choose</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="4-trim（set）"><a href="#4-trim（set）" class="headerlink" title="4.trim（set）"></a>4.trim（set）</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--public void updateEmp(Employee employee);  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateEmp&quot;</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!-- Set标签的使用 --&gt;</span><br>    <span class="hljs-comment">&lt;!--update tbl_employee </span><br><span class="hljs-comment">	&lt;set&gt;</span><br><span class="hljs-comment">   		&lt;if test=&quot;lastName!=null&quot;&gt;</span><br><span class="hljs-comment">    		last_name=#&#123;lastName&#125;,</span><br><span class="hljs-comment">   		&lt;/if&gt;</span><br><span class="hljs-comment">        &lt;if test=&quot;email!=null&quot;&gt;</span><br><span class="hljs-comment">            email=#&#123;email&#125;,</span><br><span class="hljs-comment">        &lt;/if&gt;</span><br><span class="hljs-comment">        &lt;if test=&quot;gender!=null&quot;&gt;</span><br><span class="hljs-comment">            gender=#&#123;gender&#125;</span><br><span class="hljs-comment">        &lt;/if&gt;</span><br><span class="hljs-comment">	&lt;/set&gt;</span><br><span class="hljs-comment">    where id=#&#123;id&#125; --&gt;</span><br> 		<br>	<span class="hljs-comment">&lt;!-- Trim：更新拼串 --&gt;</span><br>	update tbl_employee <br>    <span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">&quot;set&quot;</span> <span class="hljs-attr">suffixOverrides</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;lastName!=null&quot;</span>&gt;</span><br>            last_name=#&#123;lastName&#125;,<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;email!=null&quot;</span>&gt;</span><br>            email=#&#123;email&#125;,<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;gender!=null&quot;</span>&gt;</span><br>            gender=#&#123;gender&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">trim</span>&gt;</span><br>    where id=#&#123;id&#125;  <br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="5-foreach"><a href="#5-foreach" class="headerlink" title="5.foreach"></a>5.foreach</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--public List&lt;Employee&gt; getEmpsByConditionForeach(List&lt;Integer&gt; ids);  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpsByConditionForeach&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span><br>    select * from tbl_employee<br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    collection：指定要遍历的集合：</span><br><span class="hljs-comment">     list类型的参数会特殊处理封装在map中，map的key就叫list</span><br><span class="hljs-comment">    item：将当前遍历出的元素赋值给指定的变量</span><br><span class="hljs-comment">    separator:每个元素之间的分隔符</span><br><span class="hljs-comment">    open：遍历出所有结果拼接一个开始的字符</span><br><span class="hljs-comment">    close:遍历出所有结果拼接一个结束的字符</span><br><span class="hljs-comment">    index:索引。遍历list的时候是index就是索引，item就是当前值</span><br><span class="hljs-comment">            遍历map的时候index表示的就是map的key，item就是map的值</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    #&#123;变量名&#125;就能取出变量的值也就是当前遍历出的元素</span><br><span class="hljs-comment">     --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;item_id&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span></span><br><span class="hljs-tag">             <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;where id in(&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span><br>        #&#123;item_id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>批量保存(mysql)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 批量保存 --&gt;</span><br>	 <span class="hljs-comment">&lt;!--public void addEmps(@Param(&quot;emps&quot;)List&lt;Employee&gt; emps);  --&gt;</span><br>	 <span class="hljs-comment">&lt;!--MySQL下批量保存：可以foreach遍历   mysql支持values(),(),()语法--&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addEmps&quot;</span>&gt;</span><br>	 	insert into tbl_employee(<br>	 		<span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;insertColumn&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>	 	) <br>		values<br>		<span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;emps&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;emp&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>			(#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)<br>		<span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>	 <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><span class="hljs-comment">&lt;!--   --&gt;</span><br>	 <br>	 <span class="hljs-comment">&lt;!-- 这种方式需要数据库连接属性allowMultiQueries=true；</span><br><span class="hljs-comment">	 	这种分号分隔多个sql可以用于其他的批量操作（删除，修改） --&gt;</span><br>	 <span class="hljs-comment">&lt;!-- &lt;insert id=&quot;addEmps&quot;&gt;</span><br><span class="hljs-comment">	 	&lt;foreach collection=&quot;emps&quot; item=&quot;emp&quot; separator=&quot;;&quot;&gt;</span><br><span class="hljs-comment">	 		insert into tbl_employee(last_name,email,gender,d_id)</span><br><span class="hljs-comment">	 		values(#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)</span><br><span class="hljs-comment">	 	&lt;/foreach&gt;</span><br><span class="hljs-comment">	 &lt;/insert&gt; --&gt;</span><br></code></pre></td></tr></table></figure>

<p>批量保存(oracle)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Oracle数据库批量保存： </span><br><span class="hljs-comment">   Oracle不支持values(),(),()</span><br><span class="hljs-comment">   Oracle支持的批量方式</span><br><span class="hljs-comment">   1、多个insert放在begin - end里面</span><br><span class="hljs-comment">    begin</span><br><span class="hljs-comment">       insert into employees(employee_id,last_name,email) </span><br><span class="hljs-comment">       values(employees_seq.nextval,&#x27;test_001&#x27;,&#x27;test_001@atguigu.com&#x27;);</span><br><span class="hljs-comment">       insert into employees(employee_id,last_name,email) </span><br><span class="hljs-comment">       values(employees_seq.nextval,&#x27;test_002&#x27;,&#x27;test_002@atguigu.com&#x27;);</span><br><span class="hljs-comment">   end;</span><br><span class="hljs-comment">  2、利用中间表：</span><br><span class="hljs-comment">   insert into employees(employee_id,last_name,email)</span><br><span class="hljs-comment">         select employees_seq.nextval,lastName,email from(</span><br><span class="hljs-comment">                select &#x27;test_a_01&#x27; lastName,&#x27;test_a_e01&#x27; email from dual</span><br><span class="hljs-comment">                union</span><br><span class="hljs-comment">                select &#x27;test_a_02&#x27; lastName,&#x27;test_a_e02&#x27; email from dual</span><br><span class="hljs-comment">                union</span><br><span class="hljs-comment">                select &#x27;test_a_03&#x27; lastName,&#x27;test_a_e03&#x27; email from dual</span><br><span class="hljs-comment">         )	</span><br><span class="hljs-comment">  --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addEmps&quot;</span> <span class="hljs-attr">databaseId</span>=<span class="hljs-string">&quot;oracle&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- oracle第一种批量方式 --&gt;</span><br>    <span class="hljs-comment">&lt;!-- &lt;foreach collection=&quot;emps&quot; item=&quot;emp&quot; open=&quot;begin&quot; close=&quot;end;&quot;&gt;</span><br><span class="hljs-comment">    insert into employees(employee_id,last_name,email) </span><br><span class="hljs-comment">       values(employees_seq.nextval,#&#123;emp.lastName&#125;,#&#123;emp.email&#125;);</span><br><span class="hljs-comment">   &lt;/foreach&gt; --&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- oracle第二种批量方式  --&gt;</span><br>    insert into employees(<br>    <span class="hljs-comment">&lt;!-- 引用外部定义的sql --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;insertColumn&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;testColomn&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;abc&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>    )<br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;emps&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;emp&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;union&quot;</span></span><br><span class="hljs-tag">             <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;select employees_seq.nextval,lastName,email from(&quot;</span></span><br><span class="hljs-tag">             <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span><br>        select #&#123;emp.lastName&#125; lastName,#&#123;emp.email&#125; email from dual<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="6-parameter和-databaseId"><a href="#6-parameter和-databaseId" class="headerlink" title="6.parameter和_databaseId"></a>6.parameter和_databaseId</h2><h2 id="7-bind"><a href="#7-bind" class="headerlink" title="7.bind"></a>7.bind</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 两个内置参数：</span><br><span class="hljs-comment">   不只是方法传递过来的参数可以被用来判断，取值。。。</span><br><span class="hljs-comment">   mybatis默认还有两个内置参数：</span><br><span class="hljs-comment">   _parameter:代表整个参数</span><br><span class="hljs-comment">    单个参数：_parameter就是这个参数</span><br><span class="hljs-comment">    多个参数：参数会被封装为一个map；_parameter就是代表这个map</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   _databaseId:如果配置了databaseIdProvider标签。</span><br><span class="hljs-comment">    _databaseId就是代表当前数据库的别名oracle</span><br><span class="hljs-comment">--&gt;</span><br>	  <br><span class="hljs-comment">&lt;!--public List&lt;Employee&gt; getEmpsTestInnerParameter(Employee employee);  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpsTestInnerParameter&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- bind：可以将OGNL表达式的值绑定到一个变量中，方便后来引用这个变量的值 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bind</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_lastName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#x27;%&#x27;+lastName+&#x27;%&#x27;&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;_databaseId==&#x27;mysql&#x27;&quot;</span>&gt;</span><br>        select * from tbl_employee<br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;_parameter!=null&quot;</span>&gt;</span><br>            where last_name like #&#123;lastName&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;_databaseId==&#x27;oracle&#x27;&quot;</span>&gt;</span><br>        select * from employees<br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;_parameter!=null&quot;</span>&gt;</span><br>            where last_name like #&#123;_parameter.lastName&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="8-抽取可重用的sql片段"><a href="#8-抽取可重用的sql片段" class="headerlink" title="8.抽取可重用的sql片段"></a>8.抽取可重用的sql片段</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">    抽取可重用的sql片段。方便后面引用 </span><br><span class="hljs-comment">    1、sql抽取：将经常要查询的列名，或者插入用的列名抽取出来方便引用</span><br><span class="hljs-comment">    2、include来引用已经抽取的sql：</span><br><span class="hljs-comment">    3、include还可以自定义一些property，sql标签内部就能使用自定义的属性</span><br><span class="hljs-comment">      include-property：取值的正确方式$&#123;prop&#125;,</span><br><span class="hljs-comment">      #&#123;不能使用这种方式&#125;</span><br><span class="hljs-comment">--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertColumn&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;_databaseId==&#x27;oracle&#x27;&quot;</span>&gt;</span><br>        employee_id,last_name,email<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;_databaseId==&#x27;mysql&#x27;&quot;</span>&gt;</span><br>        last_name,email,gender,d_id<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h1 id="六-MyBatis缓存机制"><a href="#六-MyBatis缓存机制" class="headerlink" title="六.MyBatis缓存机制"></a>六.MyBatis缓存机制</h1><p><strong>一级缓存</strong>和<strong>二级缓存</strong></p>
<ol>
<li><p>默认情况下，只有一级缓存（SqlSession级别的缓存，也称为本地缓存）开启。</p>
</li>
<li><p>二级缓存需要手动开启和配置，他是基于namespace级别的缓存。</p>
</li>
<li><p>为了提高扩展性。MyBatis定义了缓存接口Cache。我们可以通过实现Cache接口来自定义二级缓存。</p>
</li>
</ol>
<h2 id="1-一级缓存（本地缓存）"><a href="#1-一级缓存（本地缓存）" class="headerlink" title="1.一级缓存（本地缓存）"></a>1.一级缓存（本地缓存）</h2><ul>
<li>sqlSession级别的缓存。</li>
<li>一级缓存是一直开启的；SqlSession级别的一个Map。</li>
</ul>
<ul>
<li><p>与数据库同一次会话期间查询到的数据会放在本地缓存中。</p>
</li>
<li><p>以后如果需要获取相同的数据，直接从缓存中拿，没必要再去查询数据库；</p>
</li>
<li><p>一级缓存失效情况（没有使用到当前一级缓存的情况，效果就是，还需要再向数据库发出查询）：</p>
<ol>
<li><p>sqlSession不同。</p>
</li>
<li><p>sqlSession相同，查询条件不同.(当前一级缓存中还没有这个数据)</p>
</li>
<li><p>sqlSession相同，两次查询之间执行了增删改操作(这次增删改可能对当前数据有影响)</p>
</li>
<li><p>sqlSession相同，手动清除了一级缓存（缓存清空:openSession.clearCache();）</p>
</li>
</ol>
</li>
</ul>
<p>一级缓存测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFirstLevelCache</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br>    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();<br>    SqlSession openSession = sqlSessionFactory.openSession();<br>    <span class="hljs-keyword">try</span>&#123;<br>        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);<br>        Employee emp01 = mapper.getEmpById(<span class="hljs-number">1</span>);<br>        System.out.println(emp01);<br><br>        <span class="hljs-comment">//xxxxx</span><br>        <span class="hljs-comment">//1、sqlSession不同。</span><br>        <span class="hljs-comment">//SqlSession openSession2 = sqlSessionFactory.openSession();</span><br>        <span class="hljs-comment">//EmployeeMapper mapper2 = openSession2.getMapper(EmployeeMapper.class);</span><br><br>        <span class="hljs-comment">//2、sqlSession相同，查询条件不同</span><br><br>        <span class="hljs-comment">//3、sqlSession相同，两次查询之间执行了增删改操作(这次增删改可能对当前数据有影响)</span><br>        <span class="hljs-comment">//mapper.addEmp(new Employee(null, &quot;testCache&quot;, &quot;cache&quot;, &quot;1&quot;));</span><br>        <span class="hljs-comment">//System.out.println(&quot;数据添加成功&quot;);</span><br><br>        <span class="hljs-comment">//4、sqlSession相同，手动清除了一级缓存（缓存清空）</span><br>        <span class="hljs-comment">//openSession.clearCache();</span><br><br>        Employee emp02 = mapper.getEmpById(<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">//Employee emp03 = mapper.getEmpById(3);</span><br>        System.out.println(emp02);<br>        <span class="hljs-comment">//System.out.println(emp03);</span><br>        System.out.println(emp01==emp02);<br><br>        <span class="hljs-comment">//openSession2.close();</span><br>    &#125;<span class="hljs-keyword">finally</span>&#123;<br>        openSession.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="2-二级缓存（全局缓存）"><a href="#2-二级缓存（全局缓存）" class="headerlink" title="2.二级缓存（全局缓存）"></a>2.二级缓存（全局缓存）</h2><ul>
<li><p>基于namespace级别的缓存：一个namespace对应一个二级缓存：</p>
</li>
<li><p>工作机制：</p>
<ol>
<li><p>一个会话，查询一条数据，这个数据就会被放在当前会话的一级缓存中；</p>
</li>
<li><p>如果会话关闭；一级缓存中的数据会被保存到二级缓存中；新的会话查询信息，就可以参照二级缓存中的内容；</p>
</li>
<li><p>sqlSession===EmployeeMapper==&gt;Employee</p>
<p>DepartmentMapper===&gt;Department</p>
<p>不同namespace查出的数据会放在自己对应的缓存中（map）</p>
</li>
</ol>
</li>
<li><p>效果：数据会从二级缓存中获取</p>
</li>
<li><p>查出的数据都会被默认先放在一级缓存中。</p>
</li>
<li><p>只有会话提交或者关闭以后，一级缓存中的数据才会转移到二级缓存中</p>
</li>
<li><p>使用：</p>
<ol>
<li>开启全局二级缓存配置：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cacheEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>去mapper.xml中配置使用二级缓存：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">eviction</span>=<span class="hljs-string">&quot;FIFO&quot;</span> <span class="hljs-attr">flushInterval</span>=<span class="hljs-string">&quot;60000&quot;</span> <span class="hljs-attr">readOnly</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;1024&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">cache</span>&gt;</span><br><span class="hljs-comment">&lt;!--  </span><br><span class="hljs-comment"> eviction:缓存的回收策略：</span><br><span class="hljs-comment">  • LRU – 最近最少使用的：移除最长时间不被使用的对象。</span><br><span class="hljs-comment">  • FIFO – 先进先出：按对象进入缓存的顺序来移除它们。</span><br><span class="hljs-comment">  • SOFT – 软引用：移除基于垃圾回收器状态和软引用规则的对象。</span><br><span class="hljs-comment">  • WEAK – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。</span><br><span class="hljs-comment">  • 默认的是 LRU。</span><br><span class="hljs-comment"> flushInterval：缓存刷新间隔</span><br><span class="hljs-comment">  缓存多长时间清空一次，默认不清空，设置一个毫秒值</span><br><span class="hljs-comment"> readOnly:是否只读：</span><br><span class="hljs-comment">  true：只读；mybatis认为所有从缓存中获取数据的操作都是只读操作，不会修改数据。</span><br><span class="hljs-comment">     mybatis为了加快获取速度，直接就会将数据在缓存中的引用交给用户。不安全，速度快</span><br><span class="hljs-comment">  false：非只读：mybatis觉得获取的数据可能会被修改。</span><br><span class="hljs-comment">    mybatis会利用序列化&amp;反序列的技术克隆一份新的数据给你。安全，速度慢</span><br><span class="hljs-comment"> size：缓存存放多少元素；</span><br><span class="hljs-comment"> type=&quot;&quot;：指定自定义缓存的全类名；</span><br><span class="hljs-comment">   实现Cache接口即可；</span><br><span class="hljs-comment"> --&gt;</span><br></code></pre></td></tr></table></figure>



<ol start="3">
<li>我们的POJO需要实现序列化接口</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Department</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span>&#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<p>二级缓存测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSecondLevelCache02</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br>    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();<br>    SqlSession openSession = sqlSessionFactory.openSession();<br>    SqlSession openSession2 = sqlSessionFactory.openSession();<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-comment">//1、</span><br>        DepartmentMapper mapper = openSession.getMapper(DepartmentMapper.class);<br>        DepartmentMapper mapper2 = openSession2.getMapper(DepartmentMapper.class);<br><br>        Department deptById = mapper.getDeptById(<span class="hljs-number">1</span>);<br>        System.out.println(deptById);<br>        openSession.close();<br><br>        Department deptById2 = mapper2.getDeptById(<span class="hljs-number">1</span>);<br>        System.out.println(deptById2);<br>        openSession2.close();<br>        <span class="hljs-comment">//第二次查询是从二级缓存中拿到的数据，并没有发送新的sql</span><br><br>    &#125;<span class="hljs-keyword">finally</span>&#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="3-和缓存有关的设置-属性"><a href="#3-和缓存有关的设置-属性" class="headerlink" title="3.和缓存有关的设置/属性"></a>3.和缓存有关的设置/属性</h2><ol>
<li><p>cacheEnabled=true：false：关闭缓存（二级缓存关闭）(一级缓存一直可用的)</p>
</li>
<li><p>每个select标签都有useCache=”true”：</p>
<p>​    false：不使用缓存（一级缓存依然使用，二级缓存不使用）</p>
</li>
<li><p>【每个增删改标签的：flushCache=”true”：（一级二级都会清除）】</p>
<ul>
<li><p>增删改执行完成后就会清楚缓存；</p>
</li>
<li><p>测试：flushCache=”true”：一级缓存就清空了；二级也会被清除；</p>
</li>
<li><p>查询标签：默认：flushCache=”false”：</p>
<p>​    如果flushCache=true;每次查询之后都会清空缓存；缓存是没有被使用的；</p>
</li>
</ul>
</li>
<li><p>sqlSession.clearCache();只是清除当前session的一级缓存；</p>
</li>
<li><p>localCacheScope：本地缓存作用域：（一级缓存SESSION）；当前会话的所有数据保存在会话缓存中；STATEMENT：可以禁用一级缓存；</p>
</li>
<li><p>当在某一个作用域 (一级缓存Session/二级缓存Namespaces) 进行了 C/U/D 操作后，默认该作用域下所有 select 中的缓存将被clear。</p>
</li>
</ol>
<p>​        </p>
<h2 id="4-第三方缓存整合"><a href="#4-第三方缓存整合" class="headerlink" title="4.第三方缓存整合"></a>4.第三方缓存整合</h2><ol>
<li>导入第三方缓存包；</li>
<li>导入与第三方缓存整合的适配包；<a target="_blank" rel="noopener" href="https://github.com/mybatis/ehcache-cache/releases">官方地址</a>；</li>
<li>mapper.xml中使用自定义缓存</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">cache</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ehcache</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">xsi:noNamespaceSchemaLocation</span>=<span class="hljs-string">&quot;../config/ehcache.xsd&quot;</span>&gt;</span><br> <span class="hljs-comment">&lt;!-- 磁盘保存路径 --&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">diskStore</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;D:\44\ehcache&quot;</span> /&gt;</span><br> <br> <span class="hljs-tag">&lt;<span class="hljs-name">defaultCache</span> </span><br><span class="hljs-tag">   <span class="hljs-attr">maxElementsInMemory</span>=<span class="hljs-string">&quot;10000&quot;</span> </span><br><span class="hljs-tag">   <span class="hljs-attr">maxElementsOnDisk</span>=<span class="hljs-string">&quot;10000000&quot;</span></span><br><span class="hljs-tag">   <span class="hljs-attr">eternal</span>=<span class="hljs-string">&quot;false&quot;</span> </span><br><span class="hljs-tag">   <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">&quot;true&quot;</span> </span><br><span class="hljs-tag">   <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">&quot;120&quot;</span></span><br><span class="hljs-tag">   <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">&quot;120&quot;</span> </span><br><span class="hljs-tag">   <span class="hljs-attr">diskExpiryThreadIntervalSeconds</span>=<span class="hljs-string">&quot;120&quot;</span></span><br><span class="hljs-tag">   <span class="hljs-attr">memoryStoreEvictionPolicy</span>=<span class="hljs-string">&quot;LRU&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">defaultCache</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ehcache</span>&gt;</span><br> <br><span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">属性说明：</span><br><span class="hljs-comment">l diskStore：指定数据在磁盘中的存储位置。</span><br><span class="hljs-comment">l defaultCache：当借助CacheManager.add(&quot;demoCache&quot;)创建Cache时，EhCache便会采用&lt;defalutCache/&gt;指定的的管理策略</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">以下属性是必须的：</span><br><span class="hljs-comment">l maxElementsInMemory - 在内存中缓存的element的最大数目 </span><br><span class="hljs-comment">l maxElementsOnDisk - 在磁盘上缓存的element的最大数目，若是0表示无穷大</span><br><span class="hljs-comment">l eternal - 设定缓存的elements是否永远不过期。如果为true，则缓存的数据始终有效，如果为false那么还要根据timeToIdleSeconds，timeToLiveSeconds判断</span><br><span class="hljs-comment">l overflowToDisk - 设定当内存缓存溢出的时候是否将过期的element缓存到磁盘上</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">以下属性是可选的：</span><br><span class="hljs-comment">l timeToIdleSeconds - 当缓存在EhCache中的数据前后两次访问的时间超过timeToIdleSeconds的属性取值时，这些数据便会删除，默认值是0,也就是可闲置时间无穷大</span><br><span class="hljs-comment">l timeToLiveSeconds - 缓存element的有效生命期，默认是0.,也就是element存活时间无穷大</span><br><span class="hljs-comment"> diskSpoolBufferSizeMB 这个参数设置DiskStore(磁盘缓存)的缓存区大小.默认是30MB.每个Cache都应该有自己的一个缓冲区.</span><br><span class="hljs-comment">l diskPersistent - 在VM重启的时候是否启用磁盘保存EhCache中的数据，默认是false。</span><br><span class="hljs-comment">l diskExpiryThreadIntervalSeconds - 磁盘缓存的清理线程运行间隔，默认是120秒。每个120s，相应的线程会进行一次EhCache中数据的清理工作</span><br><span class="hljs-comment">l memoryStoreEvictionPolicy - 当内存缓存达到最大，有新的element加入的时候， 移除缓存中element的策略。默认是LRU（最近最少使用），可选的有LFU（最不常使用）和FIFO（先进先出）</span><br><span class="hljs-comment"> --&gt;</span><br></code></pre></td></tr></table></figure>

<p>在其他mapper文件中引用缓存：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 引用缓存：namespace：指定和哪个名称空间下的缓存一样 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">cache-ref</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.dao.EmployeeMapper&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>



<h1 id="七-MyBatis-Spring整合"><a href="#七-MyBatis-Spring整合" class="headerlink" title="七.MyBatis-Spring整合"></a>七.MyBatis-Spring整合</h1><ol>
<li><a target="_blank" rel="noopener" href="http://www.mybatis.org/spring/">查看不同MyBatis版本整合Spring时使用的适配包</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/mybatis/spring/releases">下载整合适配包</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/mybatis/jpetstore-6">官方整合示例，jpetstore</a></li>
</ol>
<p>整合关键配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">	<span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">	<span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">	<span class="hljs-attr">xmlns:mybatis-spring</span>=<span class="hljs-string">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span></span><br><span class="hljs-tag">	<span class="hljs-attr">xmlns:tx</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="hljs-tag">	<span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">		http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring-1.2.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- Spring希望管理所有的业务逻辑组件，等。。。 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.atguigu.mybatis&quot;</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;annotation&quot;</span></span><br><span class="hljs-tag">			<span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- 引入数据库的配置文件 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:dbconfig.properties&quot;</span> /&gt;</span><br>	<span class="hljs-comment">&lt;!-- Spring用来控制业务逻辑。数据源、事务控制、aop --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbcUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClass&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>	<span class="hljs-comment">&lt;!-- spring事务管理 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- 开启基于注解的事务 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span>/&gt;</span><br>	<br>	<span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">	整合mybatis </span><br><span class="hljs-comment">		目的：1、spring管理所有组件。mapper的实现类。</span><br><span class="hljs-comment">				service==&gt;Dao   @Autowired:自动注入mapper；</span><br><span class="hljs-comment">			2、spring用来管理事务，spring声明式事务</span><br><span class="hljs-comment">	--&gt;</span><br>	<span class="hljs-comment">&lt;!--创建出SqlSessionFactory对象  --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSessionFactoryBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- configLocation指定全局配置文件的位置 --&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;configLocation&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;classpath:mybatis-config.xml&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>		<span class="hljs-comment">&lt;!--mapperLocations: 指定mapper文件的位置--&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapperLocations&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;classpath:mybatis/mapper/*.xml&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>	<br>	<span class="hljs-comment">&lt;!--配置一个可以进行批量执行的sqlSession  --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSession&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;sqlSessionFactoryBean&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;executorType&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;BATCH&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>	<br>	<span class="hljs-comment">&lt;!-- 扫描所有的mapper接口的实现，让这些mapper能够自动注入；</span><br><span class="hljs-comment">	base-package：指定mapper接口的包名</span><br><span class="hljs-comment">	 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">mybatis-spring:scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.dao&quot;</span>/&gt;</span><br>	<span class="hljs-comment">&lt;!-- &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;</span><br><span class="hljs-comment">		&lt;property name=&quot;basePackage&quot; value=&quot;com.atguigu.mybatis.dao&quot;&gt;&lt;/property&gt;</span><br><span class="hljs-comment">	&lt;/bean&gt; --&gt;</span><br>	<br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h1 id="八-MyBatis-逆向工程"><a href="#八-MyBatis-逆向工程" class="headerlink" title="八.MyBatis-逆向工程"></a>八.MyBatis-逆向工程</h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><p>MyBatis Generator：简称MBG，是一个专门为MyBatis框架使用者定制的代码生成器，可以快速的根据表生成对应的映射文件，接口，以及bean类。支持基本的增删改查，以及QBC风格的条件查询。但是表连接、存储过程等这些复杂sql的定义需要我们手工编写。</p>
<p><a target="_blank" rel="noopener" href="http://www.mybatis.org/generator/">官方文档地址</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/mybatis/generator/releases">官方工程地址</a></p>
<h2 id="2-MBG使用"><a href="#2-MBG使用" class="headerlink" title="2.MBG使用"></a>2.MBG使用</h2><h3 id="2-1-使用步骤"><a href="#2-1-使用步骤" class="headerlink" title="2.1 使用步骤"></a>2.1 使用步骤</h3><ol>
<li><p>编写MBG配置文件(详见2.3)</p>
</li>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--MBG--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.generator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-generator-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>运行代码生成器生成代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testMbg</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    List&lt;String&gt; warnings = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<br>    <span class="hljs-keyword">boolean</span> overwrite = <span class="hljs-keyword">true</span>;<br>    File configFile = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;mbg.xml&quot;</span>);<br>    ConfigurationParser cp = <span class="hljs-keyword">new</span> ConfigurationParser(warnings);<br>    Configuration config = cp.parseConfiguration(configFile);<br>    DefaultShellCallback callback = <span class="hljs-keyword">new</span> DefaultShellCallback(overwrite);<br>    MyBatisGenerator myBatisGenerator = <span class="hljs-keyword">new</span> MyBatisGenerator(config,<br>                                                             callback, warnings);<br>    myBatisGenerator.generate(<span class="hljs-keyword">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//简单版</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testMyBatis3Simple</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br>    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();<br>    SqlSession openSession = sqlSessionFactory.openSession();<br>    <span class="hljs-keyword">try</span>&#123;<br>        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);<br>        List&lt;Employee&gt; list = mapper.selectByExample(<span class="hljs-keyword">null</span>);<br>        <span class="hljs-keyword">for</span> (Employee employee : list) &#123;<br>            System.out.println(employee.getId());<br>        &#125;<br>    &#125;<span class="hljs-keyword">finally</span>&#123;<br>        openSession.close();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//豪华版</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testMyBatis3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br>    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();<br>    SqlSession openSession = sqlSessionFactory.openSession();<br>    <span class="hljs-keyword">try</span>&#123;<br>        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);<br>        <span class="hljs-comment">//xxxExample就是封装查询条件的</span><br>        <span class="hljs-comment">//1、查询所有</span><br>        <span class="hljs-comment">//List&lt;Employee&gt; emps = mapper.selectByExample(null);</span><br>        <span class="hljs-comment">//2、查询员工名字中有e字母的，和员工性别是1的</span><br>        <span class="hljs-comment">//封装员工查询条件的example</span><br>        EmployeeExample example = <span class="hljs-keyword">new</span> EmployeeExample();<br>        <span class="hljs-comment">//创建一个Criteria，这个Criteria就是拼装查询条件</span><br>        <span class="hljs-comment">//select id, last_name, email, gender, d_id from tbl_employee </span><br>        <span class="hljs-comment">//WHERE ( last_name like ? and gender = ? ) or email like &quot;%e%&quot;</span><br>        Criteria criteria = example.createCriteria();<br>        criteria.andLastNameLike(<span class="hljs-string">&quot;%e%&quot;</span>);<br>        criteria.andGenderEqualTo(<span class="hljs-string">&quot;1&quot;</span>);<br><br>        Criteria criteria2 = example.createCriteria();<br>        criteria2.andEmailLike(<span class="hljs-string">&quot;%e%&quot;</span>);<br>        example.or(criteria2);<br><br>        List&lt;Employee&gt; list = mapper.selectByExample(example);<br>        <span class="hljs-keyword">for</span> (Employee employee : list) &#123;<br>            System.out.println(employee.getId());<br>        &#125;<br><br>    &#125;<span class="hljs-keyword">finally</span>&#123;<br>        openSession.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-2-注意点"><a href="#2-2-注意点" class="headerlink" title="2.2 注意点"></a>2.2 注意点</h3><ul>
<li>Context标签：<ul>
<li><strong>targetRuntime=“MyBatis3“</strong>可以生成带条件的增删改查</li>
<li><strong>targetRuntime=“MyBatis3Simple“</strong>可以生成基本的增删改查</li>
<li>如果再次生成，建议将之前生成的数据删除，避免xml向后追加内容出现的问题。</li>
</ul>
</li>
</ul>
<h3 id="2-3-MBG配置文件"><a href="#2-3-MBG配置文件" class="headerlink" title="2.3 MBG配置文件"></a>2.3 MBG配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">generatorConfiguration</span></span><br><span class="hljs-meta">  <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span><br><span class="hljs-meta">  <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">generatorConfiguration</span>&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">		targetRuntime=&quot;MyBatis3Simple&quot;:生成简单版的CRUD</span><br><span class="hljs-comment">		MyBatis3:豪华版</span><br><span class="hljs-comment">	</span><br><span class="hljs-comment">	 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">context</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;DB2Tables&quot;</span> <span class="hljs-attr">targetRuntime</span>=<span class="hljs-string">&quot;MyBatis3&quot;</span>&gt;</span><br>  	<span class="hljs-comment">&lt;!-- jdbcConnection：指定如何连接到目标数据库 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">jdbcConnection</span> <span class="hljs-attr">driverClass</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">connectionURL</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mybatis?allowMultiQueries=true&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">userId</span>=<span class="hljs-string">&quot;root&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;123456&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">jdbcConnection</span>&gt;</span><br><br>	<span class="hljs-comment">&lt;!--  --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">javaTypeResolver</span> &gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;forceBigDecimals&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">javaTypeResolver</span>&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- javaModelGenerator：指定javaBean的生成策略 </span><br><span class="hljs-comment">	targetPackage=&quot;test.model&quot;：目标包名</span><br><span class="hljs-comment">	targetProject=&quot;\MBGTestProject\src&quot;：目标工程</span><br><span class="hljs-comment">	--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">javaModelGenerator</span> <span class="hljs-attr">targetPackage</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.bean&quot;</span> </span><br><span class="hljs-tag">    		<span class="hljs-attr">targetProject</span>=<span class="hljs-string">&quot;.\src&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;enableSubPackages&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;trimStrings&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">javaModelGenerator</span>&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- sqlMapGenerator：sql映射生成策略： --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">sqlMapGenerator</span> <span class="hljs-attr">targetPackage</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.dao&quot;</span>  </span><br><span class="hljs-tag">    	<span class="hljs-attr">targetProject</span>=<span class="hljs-string">&quot;.\conf&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;enableSubPackages&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">sqlMapGenerator</span>&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- javaClientGenerator:指定mapper接口所在的位置 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">javaClientGenerator</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;XMLMAPPER&quot;</span> <span class="hljs-attr">targetPackage</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.dao&quot;</span>  </span><br><span class="hljs-tag">    	<span class="hljs-attr">targetProject</span>=<span class="hljs-string">&quot;.\src&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;enableSubPackages&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">javaClientGenerator</span>&gt;</span><br><br>	<span class="hljs-comment">&lt;!-- 指定要逆向分析哪些表：根据表要创建javaBean --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;tbl_dept&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;Department&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;tbl_employee&quot;</span> <span class="hljs-attr">domainObjectName</span>=<span class="hljs-string">&quot;Employee&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">context</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">generatorConfiguration</span>&gt;</span><br><br></code></pre></td></tr></table></figure>



<h1 id="九-MyBatis-工作原理"><a href="#九-MyBatis-工作原理" class="headerlink" title="九.MyBatis-工作原理"></a>九.MyBatis-工作原理</h1><ol>
<li><p>获取sqlSessionFactory对象:</p>
<ul>
<li><p>解析文件的每一个信息保存在Configuration中，返回包含Configuration的DefaultSqlSession；</p>
</li>
<li><p>注意：【MappedStatement】：代表一个增删改查的详细信息</p>
</li>
</ul>
</li>
<li><p>获取sqlSession对象</p>
<ul>
<li><p>返回一个DefaultSQlSession对象，包含Executor和Configuration;</p>
</li>
<li><p>这一步会创建Executor对象；</p>
<p>获取接口的代理对象（MapperProxy）</p>
</li>
</ul>
</li>
<li><p>getMapper，使用MapperProxyFactory创建一个MapperProxy的代理对象</p>
<ul>
<li>代理对象里面包含了，DefaultSqlSession（Executor）</li>
</ul>
</li>
<li><p>执行增删改查方法</p>
</li>
</ol>
<p>总结：</p>
<ol>
<li><p>根据配置文件（全局，sql映射）初始化出Configuration对象</p>
</li>
<li><p>创建一个DefaultSqlSession对象，他里面包含Configuration以及Executor（根据全局配置文件中的defaultExecutorType创建出对应的Executor）</p>
</li>
<li><p>DefaultSqlSession.getMapper（）：拿到Mapper接口对应的MapperProxy；</p>
</li>
<li><p>MapperProxy里面有（DefaultSqlSession）；</p>
</li>
<li><p>执行增删改查方法：</p>
<ol>
<li><p>调用DefaultSqlSession的增删改查（Executor）；</p>
</li>
<li><p>会创建一个StatementHandler对象。（同时也会创建出ParameterHandler和ResultSetHandler）</p>
</li>
<li><p>调用StatementHandler预编译参数以及设置参数值;使用ParameterHandler来给sql设置参数</p>
</li>
<li><p>调用StatementHandler的增删改查方法；</p>
</li>
<li><p>ResultSetHandler封装结果</p>
<p>注意：四大对象每个创建的时候都有一个interceptorChain.pluginAll(parameterHandler);</p>
</li>
</ol>
</li>
</ol>
<h1 id="十-MyBatis-插件开发"><a href="#十-MyBatis-插件开发" class="headerlink" title="十.MyBatis-插件开发"></a>十.MyBatis-插件开发</h1><h2 id="1-插件原理"><a href="#1-插件原理" class="headerlink" title="1.插件原理"></a>1.插件原理</h2><p>在四大对象创建的时候：</p>
<ol>
<li>每个创建出来的对象不是直接返回的，而是interceptorChain.pluginAll(parameterHandler);</li>
<li>获取到所有的Interceptor（拦截器）（插件需要实现的接口）；调用interceptor.plugin(target);返回target包装后的对象</li>
<li>插件机制，我们可以使用插件为目标对象创建一个代理对象；AOP（面向切面）<pre><code>         我们的插件可以为四大对象创建出代理对象；
            代理对象就可以拦截到四大对象的每一个执行；
</code></pre>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">pluginAll</span><span class="hljs-params">(Object target)</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (Interceptor interceptor : interceptors) &#123;<br>        target = interceptor.plugin(target);<br>    &#125;<br>    <span class="hljs-keyword">return</span> target;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>默认情况下，MyBatis 允许使用插件来拦截的方法调用包括：</p>
<ul>
<li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed) </li>
<li>ParameterHandler (getParameterObject, setParameters) </li>
<li>ResultSetHandler (handleResultSets, handleOutputParameters) </li>
<li>StatementHandler (prepare, parameterize, batch, update, query) </li>
</ul>
<h2 id="2-插件编写"><a href="#2-插件编写" class="headerlink" title="2.插件编写"></a>2.插件编写</h2><ol>
<li><p>编写Interceptor的实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.mybatis.dao;<br><br><span class="hljs-keyword">import</span> java.util.Properties;<br><br><span class="hljs-keyword">import</span> org.apache.ibatis.executor.parameter.ParameterHandler;<br><span class="hljs-keyword">import</span> org.apache.ibatis.executor.statement.StatementHandler;<br><span class="hljs-keyword">import</span> org.apache.ibatis.plugin.Interceptor;<br><span class="hljs-keyword">import</span> org.apache.ibatis.plugin.Intercepts;<br><span class="hljs-keyword">import</span> org.apache.ibatis.plugin.Invocation;<br><span class="hljs-keyword">import</span> org.apache.ibatis.plugin.Plugin;<br><span class="hljs-keyword">import</span> org.apache.ibatis.plugin.Signature;<br><span class="hljs-keyword">import</span> org.apache.ibatis.reflection.MetaObject;<br><span class="hljs-keyword">import</span> org.apache.ibatis.reflection.SystemMetaObject;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 完成插件签名：</span><br><span class="hljs-comment"> *		告诉MyBatis当前插件用来拦截哪个对象的哪个方法</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Intercepts(&#123;</span><br><span class="hljs-meta">	@Signature(type=StatementHandler.class,method=&quot;parameterize&quot;,args=java.sql.Statement.class)</span><br><span class="hljs-meta">&#125;)</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFirstPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Interceptor</span></span>&#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * intercept：拦截：</span><br><span class="hljs-comment">	 * 		拦截目标对象的目标方法的执行；</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		System.out.println(<span class="hljs-string">&quot;MyFirstPlugin...intercept:&quot;</span>+invocation.getMethod());<br>		<span class="hljs-comment">//动态的改变一下sql运行的参数：以前1号员工，实际从数据库查询11号员工</span><br>		Object target = invocation.getTarget();<br>		System.out.println(<span class="hljs-string">&quot;当前拦截到的对象：&quot;</span>+target);<br>		<span class="hljs-comment">//拿到：StatementHandler==&gt;ParameterHandler===&gt;parameterObject</span><br>		<span class="hljs-comment">//拿到target的元数据</span><br>		MetaObject metaObject = SystemMetaObject.forObject(target);<br>		Object value = metaObject.getValue(<span class="hljs-string">&quot;parameterHandler.parameterObject&quot;</span>);<br>		System.out.println(<span class="hljs-string">&quot;sql语句用的参数是：&quot;</span>+value);<br>		<span class="hljs-comment">//修改完sql语句要用的参数</span><br>		metaObject.setValue(<span class="hljs-string">&quot;parameterHandler.parameterObject&quot;</span>, <span class="hljs-number">11</span>);<br>		<span class="hljs-comment">//执行目标方法</span><br>		Object proceed = invocation.proceed();<br>		<span class="hljs-comment">//返回执行后的返回值</span><br>		<span class="hljs-keyword">return</span> proceed;<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * plugin：</span><br><span class="hljs-comment">	 * 		包装目标对象的：包装：为目标对象创建一个代理对象</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">plugin</span><span class="hljs-params">(Object target)</span> </span>&#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		<span class="hljs-comment">//我们可以借助Plugin的wrap方法来使用当前Interceptor包装我们目标对象</span><br>		System.out.println(<span class="hljs-string">&quot;MyFirstPlugin...plugin:mybatis将要包装的对象&quot;</span>+target);<br>		Object wrap = Plugin.wrap(target, <span class="hljs-keyword">this</span>);<br>		<span class="hljs-comment">//返回为当前target创建的动态代理</span><br>		<span class="hljs-keyword">return</span> wrap;<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * setProperties：</span><br><span class="hljs-comment">	 * 		将插件注册时 的property属性设置进来</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setProperties</span><span class="hljs-params">(Properties properties)</span> </span>&#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		System.out.println(<span class="hljs-string">&quot;插件配置的信息：&quot;</span>+properties);<br>	&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure></li>
<li><p>使用@Intercepts注解完成插件签名</p>
</li>
<li><p>将写好的插件注册到全局配置文件中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!--plugins：注册插件  --&gt;<br>&lt;plugins&gt;<br>    &lt;plugin interceptor=<span class="hljs-string">&quot;com.atguigu.mybatis.dao.MyFirstPlugin&quot;</span>&gt;<br>        &lt;property name=<span class="hljs-string">&quot;username&quot;</span> value=<span class="hljs-string">&quot;root&quot;</span>/&gt;<br>        &lt;property name=<span class="hljs-string">&quot;password&quot;</span> value=<span class="hljs-string">&quot;123456&quot;</span>/&gt;<br>    &lt;/plugin&gt;<br>    &lt;plugin interceptor=<span class="hljs-string">&quot;com.atguigu.mybatis.dao.MySecondPlugin&quot;</span>&gt;<br>    &lt;/plugin&gt;<br>&lt;/plugins&gt;<br></code></pre></td></tr></table></figure></li>
</ol>
<h1 id="十一-MyBatis-实用场景"><a href="#十一-MyBatis-实用场景" class="headerlink" title="十一.MyBatis-实用场景"></a>十一.MyBatis-实用场景</h1><h2 id="1-PageHelper插件进行分页"><a href="#1-PageHelper插件进行分页" class="headerlink" title="1. PageHelper插件进行分页"></a>1. PageHelper插件进行分页</h2><p><a target="_blank" rel="noopener" href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/README_zh.md">官方文档</a></p>
<p>使用步骤：</p>
<ol>
<li><p>导入相关包pagehelper-x.x.x.jar 和 jsqlparser-0.9.5.jar</p>
</li>
<li><p>在MyBatis全局配置文件中配置分页插件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">interceptor</span>=<span class="hljs-string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>使用PageHelper提供的方法进行分页</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test01</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    <span class="hljs-comment">// 1、获取sqlSessionFactory对象</span><br>    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();<br>    <span class="hljs-comment">// 2、获取sqlSession对象</span><br>    SqlSession openSession = sqlSessionFactory.openSession();<br>    <span class="hljs-keyword">try</span> &#123;<br>        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);<br>        Page&lt;Object&gt; page = PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>);<br><br>        List&lt;Employee&gt; emps = mapper.getEmps();<br>        <span class="hljs-comment">//传入要连续显示多少页</span><br>        PageInfo&lt;Employee&gt; info = <span class="hljs-keyword">new</span> PageInfo&lt;&gt;(emps, <span class="hljs-number">5</span>);<br>        <span class="hljs-keyword">for</span> (Employee employee : emps) &#123;<br>            System.out.println(employee);<br>        &#125;<br>        <span class="hljs-comment">/*System.out.println(&quot;当前页码：&quot;+page.getPageNum());</span><br><span class="hljs-comment">			System.out.println(&quot;总记录数：&quot;+page.getTotal());</span><br><span class="hljs-comment">			System.out.println(&quot;每页的记录数：&quot;+page.getPageSize());</span><br><span class="hljs-comment">			System.out.println(&quot;总页码：&quot;+page.getPages());*/</span><br>        <span class="hljs-comment">///xxx</span><br>        System.out.println(<span class="hljs-string">&quot;当前页码：&quot;</span>+info.getPageNum());<br>        System.out.println(<span class="hljs-string">&quot;总记录数：&quot;</span>+info.getTotal());<br>        System.out.println(<span class="hljs-string">&quot;每页的记录数：&quot;</span>+info.getPageSize());<br>        System.out.println(<span class="hljs-string">&quot;总页码：&quot;</span>+info.getPages());<br>        System.out.println(<span class="hljs-string">&quot;是否第一页：&quot;</span>+info.isIsFirstPage());<br>        System.out.println(<span class="hljs-string">&quot;连续显示的页码：&quot;</span>);<br>        <span class="hljs-keyword">int</span>[] nums = info.getNavigatepageNums();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;<br>            System.out.println(nums[i]);<br>        &#125;<br><br><br>        <span class="hljs-comment">//xxxx</span><br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        openSession.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>可以使用更强大的PageInfo封装返回结果</p>
</li>
</ol>
<h2 id="2-批量操作"><a href="#2-批量操作" class="headerlink" title="2. 批量操作"></a>2. 批量操作</h2><h3 id="2-1-操作说明"><a href="#2-1-操作说明" class="headerlink" title="2.1 操作说明"></a>2.1 操作说明</h3><p>默认的 openSession() 方法没有参数,它会创建有如下特性的</p>
<ul>
<li><p>会开启一个事务(也就是<strong>不自动提交</strong>) </p>
</li>
<li><p>连接对象会从由活动环境配置的数据源实例得到。</p>
</li>
<li><p>事务隔离级别将会使用驱动或数据源的默认设置。</p>
</li>
<li><p> 预处理语句不会被复用,也不会批量处理更新。</p>
</li>
</ul>
<p>openSession 方法的 <strong>ExecutorType</strong> 类型的参数，枚举类型: </p>
<ul>
<li>ExecutorType.SIMPLE: 这个执行器类型不做特殊的事情（这是默认装配的）。它<strong>为每个语句的执行创建一个新的预处理语句</strong>。</li>
<li>ExecutorType.REUSE: 这个执行器类型<strong>会复用预处理语句</strong>。</li>
<li>ExecutorType.BATCH: 这个执行器会<strong>批量执行所有更新语句</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testBatch</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br>    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();<br><br>    <span class="hljs-comment">//可以执行批量操作的sqlSession</span><br>    SqlSession openSession = sqlSessionFactory.openSession(ExecutorType.BATCH);<br>    <span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>    <span class="hljs-keyword">try</span>&#123;<br>        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) &#123;<br>            mapper.addEmp(<span class="hljs-keyword">new</span> Employee(UUID.randomUUID().toString().substring(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>), <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>));<br>        &#125;<br>        openSession.commit();<br>        <span class="hljs-keyword">long</span> end = System.currentTimeMillis();<br>        <span class="hljs-comment">//批量：（预编译sql一次==&gt;设置参数===&gt;10000次===&gt;执行（1次））</span><br>        <span class="hljs-comment">//Parameters: 616c1(String), b(String), 1(String)==&gt;4598</span><br>        <span class="hljs-comment">//非批量：（预编译sql=设置参数=执行）==》10000    10200</span><br>        System.out.println(<span class="hljs-string">&quot;执行时长：&quot;</span>+(end-start));<br>    &#125;<span class="hljs-keyword">finally</span>&#123;<br>        openSession.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="2-2-与Spring整合"><a href="#2-2-与Spring整合" class="headerlink" title="2.2 与Spring整合"></a>2.2 与Spring整合</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置一个可以进行批量执行的sqlSession  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSession&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;sqlSessionFactoryBean&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;executorType&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;BATCH&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> SqlSession sqlSession;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Employee&gt; <span class="hljs-title">getEmps</span><span class="hljs-params">()</span></span>&#123;<br>    EmployeeMapper mapper = sqlSession.getMapper(EmployeeMapper.class);<br>    <span class="hljs-keyword">return</span> mapper.getEmps();<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="2-3-注意"><a href="#2-3-注意" class="headerlink" title="2.3 注意"></a>2.3 注意</h3><ol>
<li>批量操作是在session.commit()以后才发送sql语句给数据库进行执行的</li>
<li>如果我们想让其提前执行，以方便后续可能的查询操作获取数据，我们可以使用sqlSession.flushStatements()方法，让其直接冲刷到数据库进行执行</li>
</ol>
<h2 id="3-存储过程-oracle分页"><a href="#3-存储过程-oracle分页" class="headerlink" title="3. 存储过程(oracle分页)"></a>3. 存储过程(oracle分页)</h2><h3 id="3-1-在数据库创建存储过程"><a href="#3-1-在数据库创建存储过程" class="headerlink" title="3.1 在数据库创建存储过程"></a>3.1 在数据库创建存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">procedure</span><br>	hello_test(<br>    	p_start <span class="hljs-keyword">in</span> <span class="hljs-type">int</span>,p_end <span class="hljs-keyword">in</span> <span class="hljs-type">int</span>,p_count <span class="hljs-keyword">out</span> <span class="hljs-type">int</span>,p_emps <span class="hljs-keyword">out</span> sys_refcursor<br>    )<span class="hljs-keyword">as</span><br><span class="hljs-keyword">begin</span><br>	<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> p_count <span class="hljs-keyword">from</span> employees;<br>	<span class="hljs-keyword">open</span> p_emps <span class="hljs-keyword">for</span><br>		<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> rownum rn,e.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employees e <span class="hljs-keyword">where</span> rownum<span class="hljs-operator">&lt;=</span>p_end) <span class="hljs-keyword">where</span> rn<span class="hljs-operator">&gt;=</span>p_start;<br><span class="hljs-keyword">end</span> hello_test;<br></code></pre></td></tr></table></figure>



<h3 id="3-2-创建分页类"><a href="#3-2-创建分页类" class="headerlink" title="3.2 创建分页类"></a>3.2 创建分页类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.mybatis.bean;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 封装分页查询数据</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> lfy</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OraclePage</span> </span>&#123;<br>	<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> start;<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> end;<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count;<br>	<span class="hljs-keyword">private</span> List&lt;Employee&gt; emps;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getStart</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> start;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setStart</span><span class="hljs-params">(<span class="hljs-keyword">int</span> start)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.start = start;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getEnd</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> end;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEnd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> end)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.end = end;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> count;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCount</span><span class="hljs-params">(<span class="hljs-keyword">int</span> count)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.count = count;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Employee&gt; <span class="hljs-title">getEmps</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> emps;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEmps</span><span class="hljs-params">(List&lt;Employee&gt; emps)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.emps = emps;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="3-3-在mapper-xml文件中调用存储过程"><a href="#3-3-在mapper-xml文件中调用存储过程" class="headerlink" title="3.3 在mapper.xml文件中调用存储过程"></a>3.3 在mapper.xml文件中调用存储过程</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- public void getPageByProcedure(); </span><br><span class="hljs-comment"> 1、使用select标签定义调用存储过程</span><br><span class="hljs-comment"> 2、statementType=&quot;CALLABLE&quot;:表示要调用存储过程</span><br><span class="hljs-comment"> 3、&#123;call procedure_name(params)&#125;</span><br><span class="hljs-comment"> --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getPageByProcedure&quot;</span> <span class="hljs-attr">statementType</span>=<span class="hljs-string">&quot;CALLABLE&quot;</span> <span class="hljs-attr">databaseId</span>=<span class="hljs-string">&quot;oracle&quot;</span>&gt;</span><br>    &#123;call hello_test(<br>    #&#123;start,mode=IN,jdbcType=INTEGER&#125;,<br>    #&#123;end,mode=IN,jdbcType=INTEGER&#125;,<br>    #&#123;count,mode=OUT,jdbcType=INTEGER&#125;,<br>    #&#123;emps,mode=OUT,jdbcType=CURSOR,javaType=ResultSet,resultMap=PageEmp&#125;<br>    )&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;PageEmp&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;EMPLOYEE_ID&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;LAST_NAME&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;email&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;EMAIL&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;email&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br></code></pre></td></tr></table></figure>



<h3 id="3-4-测试代码"><a href="#3-4-测试代码" class="headerlink" title="3.4 测试代码"></a>3.4 测试代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* oracle分页：</span><br><span class="hljs-comment">* 		借助rownum：行号；子查询；</span><br><span class="hljs-comment">* 存储过程包装分页逻辑 </span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testProcedure</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br>    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();<br>    SqlSession openSession = sqlSessionFactory.openSession();<br>    <span class="hljs-keyword">try</span>&#123;<br>        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);<br>        OraclePage page = <span class="hljs-keyword">new</span> OraclePage();<br>        page.setStart(<span class="hljs-number">1</span>);<br>        page.setEnd(<span class="hljs-number">5</span>);<br>        mapper.getPageByProcedure(page);<br><br>        System.out.println(<span class="hljs-string">&quot;总记录数：&quot;</span>+page.getCount());<br>        System.out.println(<span class="hljs-string">&quot;查出的数据：&quot;</span>+page.getEmps().size());<br>        System.out.println(<span class="hljs-string">&quot;查出的数据：&quot;</span>+page.getEmps());<br>    &#125;<span class="hljs-keyword">finally</span>&#123;<br>        openSession.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="4-typeHandler处理枚举-用户登陆状态码"><a href="#4-typeHandler处理枚举-用户登陆状态码" class="headerlink" title="4. typeHandler处理枚举(用户登陆状态码)"></a>4. typeHandler处理枚举(用户登陆状态码)</h2><h3 id="4-1-枚举类"><a href="#4-1-枚举类" class="headerlink" title="4.1 枚举类"></a>4.1 枚举类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.mybatis.bean;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.bcel.internal.generic.RETURN;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 希望数据库保存的是100,200这些状态码，而不是默认0,1或者枚举的名</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">EmpStatus</span> </span>&#123;<br>	LOGIN(<span class="hljs-number">100</span>,<span class="hljs-string">&quot;用户登录&quot;</span>),LOGOUT(<span class="hljs-number">200</span>,<span class="hljs-string">&quot;用户登出&quot;</span>),REMOVE(<span class="hljs-number">300</span>,<span class="hljs-string">&quot;用户不存在&quot;</span>);<br>	<br>	<span class="hljs-keyword">private</span> Integer code;<br>	<span class="hljs-keyword">private</span> String msg;<br>    <br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">EmpStatus</span><span class="hljs-params">(Integer code,String msg)</span></span>&#123;<br>		<span class="hljs-keyword">this</span>.code = code;<br>		<span class="hljs-keyword">this</span>.msg = msg;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getCode</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> code;<br>	&#125;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCode</span><span class="hljs-params">(Integer code)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.code = code;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMsg</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> msg;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMsg</span><span class="hljs-params">(String msg)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.msg = msg;<br>	&#125;<br>	<br>	<span class="hljs-comment">//按照状态码返回枚举对象</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> EmpStatus <span class="hljs-title">getEmpStatusByCode</span><span class="hljs-params">(Integer code)</span></span>&#123;<br>		<span class="hljs-keyword">switch</span> (code) &#123;<br>			<span class="hljs-keyword">case</span> <span class="hljs-number">100</span>:<br>				<span class="hljs-keyword">return</span> LOGIN;<br>			<span class="hljs-keyword">case</span> <span class="hljs-number">200</span>:<br>				<span class="hljs-keyword">return</span> LOGOUT;	<br>			<span class="hljs-keyword">case</span> <span class="hljs-number">300</span>:<br>				<span class="hljs-keyword">return</span> REMOVE;<br>			<span class="hljs-keyword">default</span>:<br>				<span class="hljs-keyword">return</span> LOGOUT;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="4-2-自定义枚举类的类型处理器"><a href="#4-2-自定义枚举类的类型处理器" class="headerlink" title="4.2 自定义枚举类的类型处理器"></a>4.2 自定义枚举类的类型处理器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.mybatis.typehandler;<br><br><span class="hljs-keyword">import</span> java.sql.CallableStatement;<br><span class="hljs-keyword">import</span> java.sql.PreparedStatement;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><br><span class="hljs-keyword">import</span> org.apache.ibatis.type.JdbcType;<br><span class="hljs-keyword">import</span> org.apache.ibatis.type.TypeHandler;<br><br><span class="hljs-keyword">import</span> com.atguigu.mybatis.bean.EmpStatus;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1、实现TypeHandler接口。或者继承BaseTypeHandler</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyEnumEmpStatusTypeHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TypeHandler</span>&lt;<span class="hljs-title">EmpStatus</span>&gt; </span>&#123;<br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * 定义当前数据如何保存到数据库中</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setParameter</span><span class="hljs-params">(PreparedStatement ps, <span class="hljs-keyword">int</span> i, EmpStatus parameter,</span></span><br><span class="hljs-params"><span class="hljs-function">			JdbcType jdbcType)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		System.out.println(<span class="hljs-string">&quot;要保存的状态码：&quot;</span>+parameter.getCode());<br>		ps.setString(i, parameter.getCode().toString());<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> EmpStatus <span class="hljs-title">getResult</span><span class="hljs-params">(ResultSet rs, String columnName)</span></span><br><span class="hljs-function">			<span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		<span class="hljs-comment">//需要根据从数据库中拿到的枚举的状态码返回一个枚举对象</span><br>		<span class="hljs-keyword">int</span> code = rs.getInt(columnName);<br>		System.out.println(<span class="hljs-string">&quot;从数据库中获取的状态码：&quot;</span>+code);<br>		EmpStatus status = EmpStatus.getEmpStatusByCode(code);<br>		<span class="hljs-keyword">return</span> status;<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> EmpStatus <span class="hljs-title">getResult</span><span class="hljs-params">(ResultSet rs, <span class="hljs-keyword">int</span> columnIndex)</span></span><br><span class="hljs-function">			<span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		<span class="hljs-keyword">int</span> code = rs.getInt(columnIndex);<br>		System.out.println(<span class="hljs-string">&quot;从数据库中获取的状态码：&quot;</span>+code);<br>		EmpStatus status = EmpStatus.getEmpStatusByCode(code);<br>		<span class="hljs-keyword">return</span> status;<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> EmpStatus <span class="hljs-title">getResult</span><span class="hljs-params">(CallableStatement cs, <span class="hljs-keyword">int</span> columnIndex)</span></span><br><span class="hljs-function">			<span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>		<span class="hljs-comment">// TODO Auto-generated method stub</span><br>		<span class="hljs-keyword">int</span> code = cs.getInt(columnIndex);<br>		System.out.println(<span class="hljs-string">&quot;从数据库中获取的状态码：&quot;</span>+code);<br>		EmpStatus status = EmpStatus.getEmpStatusByCode(code);<br>		<span class="hljs-keyword">return</span> status;<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="4-3-mybatis配置文件引入自定义类型处理器"><a href="#4-3-mybatis配置文件引入自定义类型处理器" class="headerlink" title="4.3 mybatis配置文件引入自定义类型处理器"></a>4.3 mybatis配置文件引入自定义类型处理器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">typeHandlers</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--1、配置我们自定义的TypeHandler  --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">typeHandler</span> <span class="hljs-attr">handler</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.typehandler.MyEnumEmpStatusTypeHandler&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.bean.EmpStatus&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--2、也可以在处理某个字段的时候告诉MyBatis用什么类型处理器</span><br><span class="hljs-comment">    保存：#&#123;empStatus,typeHandler=xxxx&#125;</span><br><span class="hljs-comment">    查询：</span><br><span class="hljs-comment">     &lt;resultMap type=&quot;com.atguigu.mybatis.bean.Employee&quot; id=&quot;MyEmp&quot;&gt;</span><br><span class="hljs-comment">       &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;</span><br><span class="hljs-comment">       &lt;result column=&quot;empStatus&quot; property=&quot;empStatus&quot; typeHandler=&quot;&quot;/&gt;</span><br><span class="hljs-comment">      &lt;/resultMap&gt;</span><br><span class="hljs-comment">    注意：如果在参数位置修改TypeHandler，应该保证保存数据和查询数据用的TypeHandler是一样的。</span><br><span class="hljs-comment">    --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">typeHandlers</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h3 id="4-4-测试代码"><a href="#4-4-测试代码" class="headerlink" title="4.4 测试代码"></a>4.4 测试代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testEnumUse</span><span class="hljs-params">()</span></span>&#123;<br>    EmpStatus login = EmpStatus.LOGIN;<br>    System.out.println(<span class="hljs-string">&quot;枚举的索引：&quot;</span>+login.ordinal());<br>    System.out.println(<span class="hljs-string">&quot;枚举的名字：&quot;</span>+login.name());<br><br>    System.out.println(<span class="hljs-string">&quot;枚举的状态码：&quot;</span>+login.getCode());<br>    System.out.println(<span class="hljs-string">&quot;枚举的提示消息：&quot;</span>+login.getMsg());<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 默认mybatis在处理枚举对象的时候保存的是枚举的名字：EnumTypeHandler</span><br><span class="hljs-comment">* 改变使用：EnumOrdinalTypeHandler：</span><br><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testEnum</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br>    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();<br>    SqlSession openSession = sqlSessionFactory.openSession();<br>    <span class="hljs-keyword">try</span>&#123;<br>        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);<br>        Employee employee = <span class="hljs-keyword">new</span> Employee(<span class="hljs-string">&quot;test_enum&quot;</span>, <span class="hljs-string">&quot;enum@atguigu.com&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>);<br>        <span class="hljs-comment">//mapper.addEmp(employee);</span><br>        <span class="hljs-comment">//System.out.println(&quot;保存成功&quot;+employee.getId());</span><br>        <span class="hljs-comment">//openSession.commit();</span><br>        Employee empById = mapper.getEmpById(<span class="hljs-number">30026</span>);<br>        System.out.println(empById.getEmpStatus());<br>    &#125;<span class="hljs-keyword">finally</span>&#123;<br>        openSession.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/java/">java</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/MyBatis/">MyBatis</a>
                    
                      <a class="hover-with-bg" href="/tags/java/">java</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/11/15/ssm%E6%95%B4%E5%90%88/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ssm整合</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/11/11/MyBatisPlus/">
                        <span class="hidden-mobile">MyBatisPlus</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://alvis-yiang.github.io" target="_blank" rel="nofollow noopener"><span>yhblog</span></a> <i class="iconfont icon-love"></i> <a href="https://alvis-yiang.github.io" target="_blank" rel="nofollow noopener"><span>@Alvis</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
